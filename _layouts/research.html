<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} - CoMPhy Lab</title>

  <script>
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>

  <!-- Font dependencies -->
  <link rel="stylesheet" href="/assets/css/fontello/css/fontello.css">
  <link rel="stylesheet" href="/assets/css/academicons-1.7.0/css/academicons.min.css">
  <!-- Site styles -->
  <link rel="stylesheet" href="/assets/css/vendor.css">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/research.css">
  <script>
    // Check if we're on localhost
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      // Use official Font Awesome CDN for local development with version 6.7.2
      document.write('<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.7.2/css/all.css" crossorigin="anonymous">');
    } else {
      // Use Kit for production
      document.write('<script src="https://kit.fontawesome.com/b1cfd9ca75.js" crossorigin="anonymous"><\/script>');
    }
  </script>
</head>
<body id="top">

  <div id="preloader">
    <div id="loader"></div>
  </div>

  <div id="page" class="s-pagewrap">
    <header class="s-header">
      <div class="s-header__logo">
        <a class="logo" href="/index.html">
          <img src="/assets/logos/CoMPhy-Lab-no-name.png" alt="CoMPhy Lab">
        </a>
      </div>
      <a class="s-header__menu-toggle" href="#0">
        <span class="s-header__menu-text">Menu</span>
        <span class="s-header__menu-icon"></span>
      </a>
      <nav class="s-header__nav">
        <a href="#0" class="s-header__nav-close-btn"><span>Close</span></a>
        <ul class="s-header__nav-list">
          <li style="background: none;"><a href="https://scholar.google.com/citations?user=67aQviYAAAAJ" style="background: none; padding: 0;"><i class="ai ai-google-scholar" style="font-size: 1.75em;"></i></a></li>
          <li style="background: none;"><a href="https://github.com/comphy-lab" style="background: none; padding: 0;"><i class="fa-brands fa-github" style="font-size: 1.75em;"></i></a></li>
          <li><a href="/#about">About</a></li>
          <li><a href="/team">Team</a></li>
          <li><a href="/research">Research</a></li>
          <li><a href="https://publish.obsidian.md/comphy-lab/README" target="_blank">Blog</a></li>
          <li style="background: none;"><a href="https://bsky.app/profile/comphy-lab.org" style="background: none; padding: 0;"><i class="fa-brands fa-bluesky" style="font-size: 1.75em; color: #0085ff;"></i></a></li>
        </ul>
      </nav>
    </header>

    <!-- Research Section -->
    <section class="s-research">
      <div class="row">
        <div class="column">
          <div class="research-content markdown-content">
            {{ content | replace: '<iframe', '<div class="video-container"><iframe loading="lazy"' | replace: '</iframe>', '</iframe></div>' }}
          </div>
        </div>
      </div>
    </section>

    <footer id="colophon" class="s-footer">
      <div class="row">
        <div class="column lg-12 ss-copyright">
          <span>Â© Copyright CoMPhy Lab {{ 'now' | date: "%Y" }}</span>
        </div>
      </div>
      <div class="ss-go-top">
        <a class="smoothscroll" title="Back to Top" href="#top">Top</a>
      </div>
    </footer>

  </div>

  <script src="/assets/js/plugins.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <script>
    // Add badge container around consecutive badge links
    document.addEventListener('DOMContentLoaded', function() {
      const researchContent = document.querySelector('.research-content');
      const paragraphs = researchContent.getElementsByTagName('p');
      
      for (let p of paragraphs) {
        if (p.querySelectorAll('a img[src*="shields.io"]').length > 0) {
          const badgeContainer = document.createElement('div');
          badgeContainer.className = 'badge-container';
          while (p.firstChild) {
            badgeContainer.appendChild(p.firstChild);
          }
          p.appendChild(badgeContainer);
        }
      }

      // Add copy buttons to paper titles
      document.querySelectorAll('.research-content h3').forEach(titleEl => {
        // Create container
        const container = document.createElement('div');
        container.className = 'paper-title-container';
        
        // Move the title into the container
        titleEl.parentNode.insertBefore(container, titleEl);
        container.appendChild(titleEl);
        
        // Add copy button
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-button';
        copyBtn.innerHTML = '<i class="fa-regular fa-copy"></i>';
        copyBtn.setAttribute('aria-label', 'Copy citation');
        copyBtn.onclick = async (e) => {
          e.preventDefault();
          
          // Get the citation text (title + next paragraph)
          const citation = titleEl.textContent + ' ' + 
            (titleEl.nextElementSibling?.textContent || '');
          
          try {
            await navigator.clipboard.writeText(citation);
            
            // Show success feedback
            copyBtn.innerHTML = '<i class="fa-solid fa-check"></i>';
            copyBtn.classList.add('copy-success');
            
            // Reset after animation
            setTimeout(() => {
              copyBtn.innerHTML = '<i class="fa-regular fa-copy"></i>';
              copyBtn.classList.remove('copy-success');
            }, 1000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        };
        container.appendChild(copyBtn);
      });

      // Add intersection observer for animations
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1
      });

      // Observe all major elements
      document.querySelectorAll('.research-content > h2, .research-content > h3, .video-container').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
        observer.observe(el);
      });
    });

    // Lazy load videos when they come into view
    document.addEventListener('DOMContentLoaded', function() {
      const lazyVideos = document.querySelectorAll('iframe[loading="lazy"]');
      const videoObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const iframe = entry.target;
            const src = iframe.getAttribute('src');
            if (src) {
              iframe.setAttribute('src', src);
            }
            videoObserver.unobserve(iframe);
          }
        });
      });

      lazyVideos.forEach(video => {
        videoObserver.observe(video);
      });
    });
  </script>
</body>
</html> 